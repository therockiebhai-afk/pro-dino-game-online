<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Dino P2E - Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles to enhance the neon/retro theme */
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #0d0d1a;
            color: #e0e0e0;
            overflow: hidden; /* Prevent scrolling */
        }
        .font-press-start {
            font-family: 'Press Start 2P', cursive;
        }
        .text-glow-cyan {
            text-shadow: 0 0 5px #06b6d4, 0 0 10px #06b6d4, 0 0 15px #06b6d4;
        }
        .text-glow-pink {
            text-shadow: 0 0 5px #ec4899, 0 0 10px #ec4899, 0 0 15px #ec4899;
        }
        .card {
            background-color: rgba(23, 23, 38, 0.8);
            border: 1px solid #3d3d5c;
            backdrop-filter: blur(10px);
        }
        .btn-primary {
            background: linear-gradient(45deg, #ec4899, #8b5cf6);
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.5), 0 0 20px rgba(139, 92, 246, 0.5);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(236, 72, 153, 0.8), 0 0 25px rgba(139, 92, 246, 0.8);
        }
        #gameCanvas {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><line x1="0" y1="50" x2="100" y2="50" stroke="%231a1a33" /><line x1="50" y1="0" x2="50" y2="100" stroke="%231a1a33" /></svg>');
            background-size: 20px 20px;
            border: 2px solid #3d3d5c;
        }
        /* Background animated grid */
        .background-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(139, 92, 246, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(139, 92, 246, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            z-index: -1;
            animation: moveGrid 20s linear infinite;
        }
        @keyframes moveGrid {
            from { background-position: 0 0; }
            to { background-position: -400px 400px; }
        }
    </style>
</head>
<body class="w-screen h-screen flex items-center justify-center p-4">
    <div class="background-grid"></div>

    <div id="mainContainer" class="w-full max-w-4xl mx-auto text-center">
        <!-- Header -->
        <h1 class="font-press-start text-3xl md:text-5xl text-glow-cyan mb-4">NEON DINO P2E</h1>
        <p class="mb-8 text-lg text-gray-400">The Retro Arcade Play-to-Earn Simulator</p>

        <!-- Dashboard -->
        <div id="dashboard" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
            <div class="card rounded-lg p-4">
                <h2 class="font-press-start text-sm text-cyan-400 mb-2">WALLET BALANCE</h2>
                <p class="text-3xl font-bold flex items-center justify-center">
                    <span id="walletBalance" class="text-glow-cyan">0.00</span>
                    <span class="font-press-start text-lg ml-2 text-cyan-500">$NEON</span>
                </p>
            </div>
            <div class="card rounded-lg p-4">
                <h2 class="font-press-start text-sm text-pink-400 mb-2">HIGH SCORE</h2>
                <p id="highScore" class="text-3xl font-bold text-glow-pink">0</p>
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" class="relative w-full aspect-[2/1] mx-auto hidden">
            <canvas id="gameCanvas" class="w-full h-full rounded-lg"></canvas>
            <div id="gameOverScreen" class="absolute inset-0 bg-black bg-opacity-70 flex-col items-center justify-center rounded-lg hidden">
                <h2 class="font-press-start text-4xl text-red-500 text-glow-pink mb-4">GAME OVER</h2>
                <p class="text-xl mb-2">You earned: <span id="earnings" class="font-bold text-cyan-400"></span></p>
                <button id="restartButton" class="btn-primary font-press-start text-white py-3 px-6 rounded-lg text-lg">RESTART</button>
            </div>
             <div id="scoreDisplay" class="absolute top-4 right-4 font-press-start text-2xl text-white">0</div>
        </div>

        <!-- Initial Play Button -->
        <div id="startScreen">
             <button id="playButton" class="btn-primary font-press-start text-white py-4 px-8 rounded-lg text-xl mt-8 animate-pulse">
                PLAY & EARN
            </button>
            <p class="mt-4 text-gray-500">Press [SPACE] to Jump</p>
        </div>
    </div>

    <script>
    // --- DOM ELEMENTS ---
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const playButton = document.getElementById('playButton');
    const restartButton = document.getElementById('restartButton');
    const dashboard = document.getElementById('dashboard');
    const gameArea = document.getElementById('gameArea');
    const startScreen = document.getElementById('startScreen');
    const gameOverScreen = document.getElementById('gameOverScreen');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const walletBalanceDisplay = document.getElementById('walletBalance');
    const highScoreDisplay = document.getElementById('highScore');
    const earningsDisplay = document.getElementById('earnings');

    // --- GAME CONFIG ---
    let canvasWidth, canvasHeight;
    const playerWidth = 40;
    const playerHeight = 40;
    const gravity = 0.6;
    const jumpStrength = -12;
    let gameSpeed = 5;
    const gameSpeedIncrease = 0.001;
    const tokenConversionRate = 10; // 10 score points = 1 $NEON token

    // --- GAME STATE ---
    let player, obstacles, score, highScore, walletBalance, isGameOver, animationFrameId;

    function initializeState() {
        player = {
            x: 50,
            y: canvasHeight - playerHeight,
            width: playerWidth,
            height: playerHeight,
            dy: 0, // velocity y
            onGround: true
        };
        obstacles = [];
        score = 0;
        highScore = localStorage.getItem('dinoHighScore') || 0;
        walletBalance = parseFloat(localStorage.getItem('dinoWalletBalance')) || 0;
        isGameOver = false;
        gameSpeed = 5;
        
        updateDisplays();
    }

    function updateDisplays() {
        highScoreDisplay.textContent = highScore;
        walletBalanceDisplay.textContent = walletBalance.toFixed(2);
        scoreDisplay.textContent = Math.floor(score);
    }
    
    // --- RESIZE CANVAS ---
    function resizeCanvas() {
        const container = document.getElementById('gameArea');
        canvas.width = container.offsetWidth;
        canvas.height = container.offsetHeight;
        canvasWidth = canvas.width;
        canvasHeight = canvas.height;
        // Re-initialize state if game is not running to adapt player position
        if (playButton.style.display !== 'none' || isGameOver) {
             initializeState();
        }
    }

    // --- DRAWING FUNCTIONS ---
    function drawPlayer() {
        ctx.fillStyle = '#06b6d4'; // Cyan
        ctx.fillRect(player.x, player.y, player.width, player.height);
        // Add a glow effect
        ctx.shadowColor = '#06b6d4';
        ctx.shadowBlur = 15;
        ctx.fillRect(player.x, player.y, player.width, player.height);
        ctx.shadowBlur = 0;
    }

    function drawObstacles() {
        ctx.fillStyle = '#ec4899'; // Pink
        obstacles.forEach(obstacle => {
            // Add a glow effect
            ctx.shadowColor = '#ec4899';
            ctx.shadowBlur = 15;
            ctx.fillRect(obstacle.x, obstacle.y, obstacle.width, obstacle.height);
            ctx.shadowBlur = 0;
        });
    }

    function clearCanvas() {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
    }

    // --- GAME LOGIC ---
    function handleJump(e) {
        if (e.code === 'Space' && player.onGround) {
            player.dy = jumpStrength;
            player.onGround = false;
        }
    }

    function spawnObstacle() {
        const minHeight = 20;
        const maxHeight = 70;
        const minWidth = 20;
        const maxWidth = 40;
        const height = Math.floor(Math.random() * (maxHeight - minHeight + 1)) + minHeight;
        const width = Math.floor(Math.random() * (maxWidth - minWidth + 1)) + minWidth;

        obstacles.push({
            x: canvasWidth,
            y: canvasHeight - height,
            width: width,
            height: height
        });
    }

    function updatePlayer() {
        player.dy += gravity;
        player.y += player.dy;

        if (player.y + player.height > canvasHeight) {
            player.y = canvasHeight - player.height;
            player.dy = 0;
            player.onGround = true;
        }
    }

    function updateObstacles() {
        for (let i = obstacles.length - 1; i >= 0; i--) {
            obstacles[i].x -= gameSpeed;
            if (obstacles[i].x + obstacles[i].width < 0) {
                obstacles.splice(i, 1);
            }
        }
    }
    
    function detectCollision() {
        for (const obstacle of obstacles) {
            if (
                player.x < obstacle.x + obstacle.width &&
                player.x + player.width > obstacle.x &&
                player.y < obstacle.y + obstacle.height &&
                player.y + player.height > obstacle.y
            ) {
                endGame();
            }
        }
    }
    
    // --- GAME LOOP ---
    let lastObstacleSpawnTime = 0;
    let obstacleSpawnInterval = 2000; // Start interval

    function gameLoop(currentTime) {
        if (isGameOver) return;

        clearCanvas();
        
        updatePlayer();
        drawPlayer();
        
        updateObstacles();
        drawObstacles();
        
        // Spawn obstacles with increasing frequency
        if (currentTime - lastObstacleSpawnTime > obstacleSpawnInterval) {
            spawnObstacle();
            lastObstacleSpawnTime = currentTime;
            // Decrease spawn interval to make game harder
            if (obstacleSpawnInterval > 800) {
                 obstacleSpawnInterval -= gameSpeed * 2;
            }
        }
        
        detectCollision();
        
        score += 0.1;
        gameSpeed += gameSpeedIncrease;
        scoreDisplay.textContent = Math.floor(score);
        
        animationFrameId = requestAnimationFrame(gameLoop);
    }
    
    // --- GAME STATE MANAGEMENT ---
    function startGame() {
        isGameOver = false;
        resizeCanvas(); // Ensure canvas is sized correctly before starting
        initializeState();
        
        dashboard.classList.add('hidden');
        startScreen.classList.add('hidden');
        gameArea.classList.remove('hidden');
        gameOverScreen.classList.add('hidden');

        // Reset obstacle spawn timer
        obstacleSpawnInterval = 2000;
        lastObstacleSpawnTime = 0;

        animationFrameId = requestAnimationFrame(gameLoop);
    }

    function endGame() {
        if (isGameOver) return; // Prevent multiple calls
        isGameOver = true;
        cancelAnimationFrame(animationFrameId);
        
        const finalScore = Math.floor(score);
        const earnedTokens = finalScore / tokenConversionRate;
        
        walletBalance += earnedTokens;
        
        if (finalScore > highScore) {
            highScore = finalScore;
            localStorage.setItem('dinoHighScore', highScore);
        }
        
        localStorage.setItem('dinoWalletBalance', walletBalance.toFixed(2));
        
        earningsDisplay.textContent = `${earnedTokens.toFixed(2)} $NEON`;
        updateDisplays();

        gameOverScreen.style.display = 'flex'; // Use style to override hidden class
        dashboard.classList.remove('hidden');
    }
    
    // --- EVENT LISTENERS ---
    playButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', startGame);
    document.addEventListener('keydown', handleJump);
    window.addEventListener('resize', resizeCanvas);

    // --- INITIALIZATION ---
    window.onload = () => {
        resizeCanvas();
        initializeState();
    };

    </script>
</body>
</html>
